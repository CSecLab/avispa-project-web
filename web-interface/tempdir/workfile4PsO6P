roleÂ gateway(GW,KDC:agent,
 Pgw,Pkdc: public_key,
 H1, H2          : hash_func, 
IDgw, P            : text,
SND,RCV:channel(dy))
played_by GW def=
local State :nat,
Kgw, group-req          :text
        M                  : message
         
init State :=0
transition
0.State=Â 0 / RCV(start) =|> 
Â Â Â Â Â Â Â Â State':=Â 1Â /Â Kgw'Â :=Â new() 
                  Â /Â SND({Kgw'.P , IDgw}_Pkdc)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â /Â secret(P,EC,{GW, KDC})Â 
                   /Â request(KDC, GW, keyserv_gateway_ec, IDgw)
Â Â Â Â 2.Â Â StateÂ Â =Â 2Â /Â RCV(M')Â =|>Â 
Â Â Â Â Â Â Â Â 
endÂ role

roleÂ key_serverÂ ( KDC,Â GWÂ Â Â Â Â Â Â Â :Â agent,
Â Â Â Â Â Â Â Â Â Â Â Â  Pgw,Â PkdcÂ Â Â Â Â    :Â public_key,
             P                :Â text,
             H1, H2           : hash_func, 
Â Â Â Â Â Â Â Â Â Â Â Â  SND,Â RCVÂ Â Â       :Â channelÂ (dy))
played_byÂ KDCÂ def=
Â Â localÂ StateÂ :Â nat,Â 
Â Â Â Â Â Â Â Â Kgw :Â text
        M, M1            : message
         
Â Â transition
Â Â Â Â 1.Â Â StateÂ Â =Â 1Â /Â RCV({Kgw'.P, IDgw}_Pkdc)Â =|>Â 
Â Â Â Â Â Â Â Â State':=Â 2Â /Â M1'Â :=Â H1(Kgw'.P, IDgw)
                   /Â M'Â :=Â ((M1')_inv(Pkdc))Â 
                   /Â SND({M'})
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â /Â secret(M',Dg,{GW, KDC})
Â Â Â Â 
endÂ role

role session(GW, KDC    :agent,
             Pgw,Â PkdcÂ Â Â Â Â   :Â public_key,
             H1, H2          : hash_func, 
             IDgw, P            :Â text)
def=
      local SNDGW, RCVGW, SNDKDC, RCVKDC    :channel(dy)
 composition
             gateway(GW, KDC, Pgw,Â Pkdc, H1, H2, IDgw, P, SGW, RGW) 
           /key_server(KDC, GW, Pgw,Â Pkdc, H1, H2, IDgw, P, SKDC, RKDC)

endÂ role

role enviroment()

def= 
const GW, KDC, SM        : agent,
      K
 